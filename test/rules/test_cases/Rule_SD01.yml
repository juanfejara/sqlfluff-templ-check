rule: SD01

forbidden_hardcoded_table:
  fail_str: |
    select
      bar,
      baz
    from tbl
    order by bar

forbidden_from_multiples_reference:
  fail_str: |
    select
      a.a,
      sum(b.b)
    from {{ ref('tbl') }} as a, tbl2 as b

regular_from_multiples_reference:
  pass_str: |
    select
      a.a,
      sum(b.b)
    from {{ ref('tbl') }} as a, {{ ref('tbl2') }} as b

regular_from_reference:
  pass_str: |
    select
      a,
      sum(b)
    from {{ ref('tbl') }}
    group by a
    order by a

regular_join_reference:
  pass_str: |
    select
      a,
      b,
      c
    from {{ ref('tbl') }}
    inner join {{ ref('tbl2') }}

forbidden_regular_from_plus_join_reference:
  fail_str: |
    select
      a,
      b,
      c
    from tbl
    inner join {{ ref('tbl2') }}

forbidden_regular_join_reference:
  fail_str: |
    select
      a,
      b,
      c
    from {{ ref('tbl') }}
    inner join tbl2

regular_join_reference_with_source_in_from:
  pass_str: |
    select
      a,
      b,
      c
    from {{ source('compatibility', 'tbl2') }}

regular_join_reference_with_source_instead:
  pass_str: |
    select
      a,
      b,
      c
    from {{ ref('tbl') }}
    inner join {{ source('compatibility', 'tbl2') }}

regular_from_a_select_with_reference:
  pass_str: |
    select
      a,
      sum(b)
    from (select * from {{ ref('tbl') }})
    group by a
    order by a

regular_from_a_select_with_invalid_reference:
  fail_str: |
    select
      a,
      sum(b)
    from (select * from tbl)
    group by a
    order by a

forbidden_from_multiple_select_with_invalid_reference:
  fail_str: |
    select
      a.a,
      sum(b.b)
    from (select * from {{ ref('tbl') }}) as a, (select * from tbl2)
    group by a
    order by a

regular_extract_exception:
  pass_str: |
    select
      extract(day from a),
      b,
      c
    from {{ ref('tbl') }}
    inner join {{ ref('tbl2') }}

allowed_alias_reference:
  pass_str: |
    with allow_alias as (
      select
        bar,
        baz
      from {{ ref('tbl') }}
    )
    , another_alias as (
      select
        bar,
        baz
      from {{ ref('tbl2') }}
    )
    select
      bar,
      baz
    from allow_alias
